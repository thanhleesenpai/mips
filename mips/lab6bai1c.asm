.data
input_string: .space 100      # Chu?i ?? l?u ??u vào
output_array: .space 120     # M?ng ?? l?u các s? (t?i ?a 30 s?, m?i s? chi?m 4 byte)

.text
main:
    # Nh?p chu?i t? bàn phím
    li $v0, 8            # syscall 8: ??c chu?i
    la $a0, input_string  # ??a ch? c?a chu?i ??u vào
    li $a1, 100           # ?? dài t?i ?a c?a chu?i
    syscall

    # L?p qua chu?i ??u vào ?? ??c t?ng s?
    la $t0, input_string  # ??a ch? b?t ??u c?a chu?i ??u vào
    la $t1, output_array # ??a ch? b?t ??u c?a m?ng s?
    li $t4, 0            # Bi?n ??m s? ?ã nh?p

read_loop:
    lb $t2, 0($t0)       # ??c m?t ký t? t? chu?i ??u vào
    beq $t2, 0, end_read  # N?u g?p ký t? k?t thúc chu?i (\0) thì k?t thúc
    beq $t2, 32, skip_space # N?u là d?u cách thì b? qua

    # Chuy?n ký t? thành s?
    sub $t2, $t2, 48     # Chuy?n t? mã ASCII sang s? nguyên
    lw $t3, 0($t1)       # ??c s? hi?n t?i t? m?ng
    sll $t3, $t3, 3      # Nhân 4 ?? d?ch bit sang trái 2 l?n (t??ng ???ng * 4)
    add $t3, $t3, $t2    # Thêm s? m?i vào m?ng
    sw $t3, 0($t1)       # L?u s? vào m?ng
    addi $t0, $t0, 1     # T?ng con tr? c?a chu?i ??u vào
    addi $t1, $t1, 4     # D?ch con tr? c?a m?ng 4 byte (kích th??c c?a m?i s?)
    addi $t4, $t4, 1     # T?ng bi?n ??m s? ?ã nh?p
    beq $t4, 30, end_read # N?u ?ã nh?p ?? 30 s? thì k?t thúc
    j read_loop

skip_space:
    addi $t0, $t0, 1     # B? qua d?u cách
    j read_loop

end_read:
    # S?p x?p m?ng theo th? t? gi?m d?n (s? d?ng thu?t toán s?p x?p chèn)
    li $t5, 30            # ?? dài c?a m?ng (t?i ?a 30 s?)
    li $t6, 1             # B??c nh?y trong vòng l?p

outer_loop:
    subi $t5, $t5, 1      # Gi?m ?? dài m?ng ?ã s?p x?p
    beqz $t5, end_sort    # N?u m?ng ?ã ???c s?p x?p thì thoát

    li $t4, 1             # B?t ??u t? ph?n t? th? hai
    move $t2, $t1         # L?u ??a ch? c?a m?ng
    add $t2, $t2, $t6     # Di chuy?n ??n ph?n t? th? hai

inner_loop:
    lw $t7, 0($t2)        # ??c giá tr? c?a ph?n t? hi?n t?i
    lw $t8, -4($t2)       # ??c giá tr? c?a ph?n t? tr??c ?ó
    ble $t7, $t8, no_swap # N?u giá tr? hi?n t?i l?n h?n giá tr? tr??c ?ó thì không ??i ch?

    # Hoán ??i giá tr? c?a hai ph?n t?
    sw $t7, -4($t2)       # L?u giá tr? hi?n t?i vào v? trí c?a giá tr? tr??c ?ó
    sw $t8, 0($t2)        # L?u giá tr? c?a giá tr? tr??c ?ó vào v? trí c?a giá tr? hi?n t?i

no_swap:
    subi $t2, $t2, 4      # Di chuy?n v? phía tr??c trong m?ng
    addi $t4, $t4, 1      # T?ng ch? s? c?a ph?n t? hi?n t?i

    blt $t4, $t5, inner_loop  # L?p l?i cho t?t c? các ph?n t? c?a m?ng

    j outer_loop

end_sort:

    # In m?ng ?ã s?p x?p theo th? t? gi?m d?n
    la $t1, output_array   # ??a ch? b?t ??u c?a m?ng s?
    li $t4, 0              # Kh?i t?o bi?n ??m s?
print_loop:
    lw $a0, 0($t1)         # Load giá tr? t? m?ng
    li $v0, 1              # syscall 1: In s? nguyên
    syscall

    li $v0, 11             # In d?u cách
    li $a0, 32
    syscall

    addi $t1, $t1, 4       # Di chuy?n ??n ph?n t? ti?p theo trong m?ng
    addi $t4, $t4, 1       # T?ng bi?n ??m s? ?ã in
    bne $t4, 30, print_loop  # N?u ch?a in h?t thì l?p l?i

    # K?t thúc ch??ng trình
    li $v0, 10            # syscall 10: K?t thúc ch??ng trình
    syscall
